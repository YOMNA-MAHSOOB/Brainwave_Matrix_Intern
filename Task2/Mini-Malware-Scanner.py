import tkinter as tk
from tkinter import filedialog
from tkinter import messagebox
import os

BG_COLOR = "#ffe6f0"         
BTN_COLOR = "#ffb3d9"        
BTN_HOVER = "#ff99cc"        
TEXT_COLOR = "#99004d" 

root = tk.Tk()
root.title("Malware Scanner")
root.geometry("800x800")
root.resizable(False, False)
root.configure(bg=BG_COLOR)

file_path= tk.StringVar()

def browse_file():
    path = filedialog.askopenfilename()
    if path:
        file_path.set(path)
        scan_btn.config(state="normal")
suspicious_keywords = {
    "os.system": "High",
    "eval": "High",
    "subprocess": "High",
    "exec": "Medium",
    "socket": "Medium",
    "base64": "Low",
    "pickle": "Low"
}


def scan_file():
    report="Suspicious keywords found:\n"
    result_box.config(state=tk.NORMAL)
    result_box.delete("1.0", tk.END)
    path = file_path.get()
    allowed_extensions = (".py", ".sh")
    if not path.endswith(allowed_extensions):
      result_box.insert(tk.END, "Only script files (.py, .sh) are allowed.\n")
      result_box.config(state=tk.DISABLED)
      return

    if not os.path.isfile(path):
        result_box.insert(tk.END, "Invalid file path.\n")
        result_box.config(state=tk.DISABLED)
        return

    try:
        with open(path, "r", errors="ignore") as f:
            content = f.read()

        found = []
        for word,level in suspicious_keywords.items():     
            if word in content:
                found.append((word, level))
                report += f" - {word}"

        if found:
            result_box.insert(tk.END, "Suspicious keywords found:\n")
            for kw in found:
                 result_box.insert(tk.END, f" - {kw}   [{level} Risk]\n")
        else:
            result_box.insert(tk.END, "No suspicious keywords found.\n")     

    except Exception as e:
        result_box.insert(tk.END, f"Error reading file: {e}\n")

    result_box.config(state=tk.DISABLED)
    with open("scan_report.txt", "w") as rep_file:
        rep_file.write(report)

def open_report():
    if os.path.exists("scan_report.txt"):
        os.system("xdg-open scan_report.txt")  
    else:
        messagebox.showerror("Error", "No report file found.")

def on_enter(e):
    e.widget['bg'] = BTN_HOVER
def on_leave(e):
    e.widget['bg'] = BTN_COLOR



title_label = tk.Label(root, text=" Simple Malware Scanner ", font=("Arial", 16, "bold"),
                       bg=BG_COLOR, fg=TEXT_COLOR)
title_label.pack(pady=10)

browse_btn = tk.Button(root, text=" Browse File", command=browse_file,
                       bg=BTN_COLOR, fg=TEXT_COLOR, font=("Arial", 12, "bold"))
generate_btn = tk.Button(root, text=" Open Report", command=open_report, bg=BTN_COLOR, 
                        fg=TEXT_COLOR,font=("Arial", 12, "bold"))
generate_btn.pack(pady=10)

browse_btn.pack()
browse_btn.bind("<Enter>", on_enter)
browse_btn.bind("<Leave>", on_leave)

file_label = tk.Label(root, textvariable=file_path, wraplength=600,
                      bg=BG_COLOR, fg=TEXT_COLOR, font=("Arial", 10))
file_label.pack(pady=10)


scan_btn = tk.Button(root, text=" Scan",state="disabled", command=scan_file,
                     bg=BTN_COLOR, fg=TEXT_COLOR, font=("Arial", 12, "bold"))
scan_btn.pack(pady=10)
scan_btn.bind("<Enter>", on_enter)
scan_btn.bind("<Leave>", on_leave)

result_box = tk.Text(root, height=12, width=60, bg="#fff0f5",
                     fg=TEXT_COLOR, font=("Courier", 15))
result_box.pack(pady=10)
result_box.insert(tk.END, "Result will appear here...\n")
result_box.config(state=tk.DISABLED)

root.mainloop()